---
import Layout from "../../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";

type Pub = CollectionEntry<"publications">;

const all = (await getCollection("publications")) as Pub[];
const publications = all
  .filter((p) => p.data.kind === "post")
  .sort((a, b) => (b.data.publishedAt?.valueOf() ?? 0) - (a.data.publishedAt?.valueOf() ?? 0));
---

<Layout title="Publications">
  <main class="bg-[#f0f4f8] min-h-screen">
    <section class="max-w-5xl mx-auto px-4 lg:px-0 py-12">
      <div class="bg-white rounded-lg shadow-sm border-l-4 border-gray-200 p-10">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">Publications</h1>

        <div class="space-y-10">
          {publications.map((pub) => (
            <article class="max-w-lg">
              {pub.data.cover && (
                <Image
                  src={pub.data.cover}
                  alt={pub.data.coverAlt ?? pub.data.title}
                  class="w-full h-auto object-cover rounded-sm"
                  loading="lazy"
                />
              )}

              <a
                href={`/publications/${pub.slug}`}
                class="mt-6 block text-base font-semibold text-gray-900 underline underline-offset-2"
              >
                {pub.data.title}
              </a>

              <a
                href={`/publications/${pub.slug}`}
                class="mt-6 inline-flex items-center justify-center w-full rounded-full text-white text-base font-medium py-3.5 transition-colors"
                style="background-color:#00d27f;"
              >
                Lire l'article
              </a>
            </article>
          ))}
        </div>
      </div>
    </section>
  </main>
</Layout>
