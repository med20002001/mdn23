---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import EventNavigation from "../../components/agenda/EventNavigation";

import EventHeader from "./presentationvisuelle/EventHeader.astro";
import EventContent from "./presentationvisuelle/EventContent.astro";
import EventSidebar from "./presentationvisuelle/EventSidebar.astro";
import EventMap from "./presentationvisuelle/EventMap.astro";

export const prerender = true;
type EventEntry = CollectionEntry<"events">;

interface Props {
  event: EventEntry;
  allEvents: EventEntry[];
}
export async function getStaticPaths() {
  const events = await getCollection("events");

  return events.map((event: EventEntry) => ({
    params: { slug: event.slug },
    props: { event, allEvents: events },
  }));
}
const { event, allEvents } = Astro.props as Props;
const { Content } = await event.render();
const now = new Date();
const isPast = event.data.date < now;
const eventsData = allEvents.map((e: EventEntry) => ({
  slug: e.slug,
  title: e.data.title,
  date: e.data.date,
}));
---
<Layout title={event.data.title}>
  <main class="bg-background text-foreground">

    <!-- Retour -->
    <div class="border-b bg-muted/40">
      <div class="mx-auto max-w-6xl px-4 py-4">
        <a href="/agenda" class="text-sm text-muted-foreground hover:text-foreground">
          ← Tous les événements
        </a>
      </div>
    </div>
    {isPast && (
      <div class="border-b">
        <div class="mx-auto max-w-6xl px-4 py-4">
          <span class="inline-flex rounded-full border px-3 py-1 text-xs text-muted-foreground">
            Cet événement est passé
          </span>
        </div>
      </div>
    )}

    <div class="mx-auto max-w-6xl px-4 py-10">
      <div class="rounded-lg border bg-card p-8 shadow-sm">

        <EventHeader event={event} />
        <EventContent event={event} Content={Content} />

      </div>

      <div class="h-12"></div>

      <div class="grid grid-cols-1 gap-6 md:grid-cols-4">
        <EventSidebar event={event} />
        <EventMap event={event} />
      </div>

      <div class="mt-12">
        <EventNavigation
          client:load
          currentSlug={event.slug}
          allEvents={eventsData}
        />
      </div>
    </div>
  </main>
</Layout>
